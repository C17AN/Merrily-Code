---
title: ë¯¸ë¦¬ ë§Œë‚˜ë³´ëŠ” automatic batching
date: "2021-12-27"
description: ë¦¬ì•¡íŠ¸ 18ì˜ automatic batching ì„ ì•Œì•„ë´…ì‹œë‹¤.
category: react
thumbnailUrl: "/thumbnails/react.svg"
tags: ["React 18", "ë¦¬ì•¡íŠ¸"]
---

### **TL;DR**

1\. ë¦¬ì•¡íŠ¸ì—ì„œëŠ” ì¤‘ë³µë˜ëŠ” ìƒíƒœ ì—…ë°ì´íŠ¸ë¥¼ ë°°ì¹­ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ìˆë‹¤.  
2\. ê¸°ì¡´ì—ëŠ” ë¹„ë™ê¸° í”„ë¡œì„¸ìŠ¤ ì•ˆì—ì„œ ë°œìƒí•˜ëŠ” ì¤‘ë³µëœ ìƒíƒœ ì—…ë°ì´íŠ¸ì—ëŠ” ë°°ì¹­ì„ ì ìš©í•˜ì§€ ì•Šì•˜ì§€ë§Œ, ë²„ì „ 18ë¶€í„°ëŠ” í•­ìƒ ë°°ì¹­ì„ ì ìš©í•œë‹¤.

---

2013ë…„ ì²˜ìŒ ì„¸ìƒì— ë“±ì¥í•œ ë¦¬ì•¡íŠ¸ëŠ” í˜„ì¬ ìµœê³ ì˜ ì „ì„±ê¸°ë¥¼ ëˆ„ë¦¬ê³  ìˆê³ , ì´ì œëŠ” ë²„ì „ 18ì˜ ì¶œì‹œë¥¼ ëˆˆì•ì— ë‘ê³  ìˆìŠµë‹ˆë‹¤.

![ë§ì€ ê°œë°œìë“¤ì˜ ì•ˆë„ì˜ í•œìˆ¨..!](https://drive.google.com/uc?export=view&id=1a3sEqeD3oS22fmPU5IgJaL1TpZ0ryOEM "600px")

ë²„ì „ 17ì—ì„œëŠ” ë‚´ë¶€ì ì¸ ìµœì í™” ë° ì•ˆì •í™”ì— ì´ˆì ì„ ë§ì¶° ë³„ë‹¤ë¥¸ ë³€í™”ë¥¼ ì²´ê°í•˜ì§€ ëª»í–ˆì§€ë§Œ, í˜„ì¬ ë² íƒ€ë¡œ ì¶œì‹œëœ ë¦¬ì•¡íŠ¸ ë²„ì „ 18ì—ì„œëŠ” ëª‡ ê°€ì§€ ëˆˆì— ë„ëŠ” ë³€ê²½ì‚¬í•­ì´ ìˆëŠ”ë°ìš”, ì˜¤ëŠ˜ì€ ê·¸ ì¤‘ `automatic-batching` ì´ë¼ëŠ” ìƒˆë¡œ ì¶”ê°€ëœ ì„±ì§ˆì„ ì†Œê°œí•´ë³´ë ¤ í•©ë‹ˆë‹¤.

## **ì‹œì‘í•˜ê¸° ì „ì—**

ì‹œì‘í•˜ê¸° ì „, ë¦¬ì•¡íŠ¸ ë²„ì „ 18ì˜ ì„¤ì •ë°©ë²•ì„ ê°„ë‹¨íˆ ì†Œê°œí•˜ê³ ì í•©ë‹ˆë‹¤.

### **1\. ìµœì‹  ë²„ì „ ì„¤ì¹˜**

ë¨¼ì € CRAë¡œ ë¦¬ì•¡íŠ¸ í”„ë¡œì íŠ¸ë¥¼ êµ¬ì¶•í•œ ë‹¤ìŒ `package.json` ì˜ ë””íœë˜ì‹œ ëª©ë¡ì—ì„œ `react` ì™€ `react-dom` ì„ ì œê±°í•©ë‹ˆë‹¤.

```
"dependencies": {
    ...
    "react-scripts": "5.0.0",
  },
```

ê·¸ í›„ ìµœì‹  ë²„ì „ì˜ ë¦¬ì•¡íŠ¸ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.

```
yarn add react@rc react-dom@rc
```

```
"dependencies": {
    ...
    "react": "^18.0.0-rc.0",
    "react-dom": "^18.0.0-rc.0",
    "react-scripts": "5.0.0",
  },
```

### **2\. index.js ì„¤ì •**

ë²„ì „ 18ë¶€í„°ëŠ” `ReactDOM.render` ëŒ€ì‹ , `createRoot` ë©”ì„œë“œë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ê°ìŒ€ DOM ìš”ì†Œë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

```
const container = document.getElementById("root");
const root = ReactDOM.createRoot(container)
```

ê·¸ë¦¬ê³  ì»¨í…Œì´ë„ˆì˜ ìì‹ìœ¼ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë Œë”ë§í•©ë‹ˆë‹¤.

```
const container = document.getElementById("root");
const root = ReactDOM.createRoot(container)
root.render(<App/>);
```

ì´ì œ ë¦¬ì•¡íŠ¸ 18ì„ ë§Œë‚˜ë³¼ ì¤€ë¹„ê°€ ëª¨ë‘ ëë‚¬ìŠµë‹ˆë‹¤!

## ì´ì „ ë²„ì „ ë¦¬ì•¡íŠ¸ì˜ ë°°ì¹­(batching) ì—…ë°ì´íŠ¸

ê°œë°œìì—ê²Œ ì‚¬ìš© ì—¬ë¶€ê°€ ë‹¬ë¦° `ErrorBoundary`, `Suspense` ë“±ì„ ì œì³ë‘ê³  ë°°ì¹­ì— ëŒ€í•´ ë‹¤ë£¨ëŠ” ì´ìœ ëŠ” ì´ë²ˆ ë²„ì „ë¶€í„°ëŠ” íŠ¹ì • ìƒí™©ì—ì„œ ë¦¬ì•¡íŠ¸ê°€ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” ë°©ì‹ì´ ì™„ì „íˆ ë³€í•´, ê¼­ ì§šê³  ë„˜ì–´ê°ˆë§Œ í•˜ë‹¤ê³  ì—¬ê²¼ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

#

ê·¸ëŸ°ë° ì´ì „ ë²„ì „(~17)ê¹Œì§€ì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ëŠ” ì‚¬ì‹¤ ë™ê¸°ì ìœ¼ë¡œ ì¼ì–´ë‚˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì‚¬ì‹¤ì„ ì•Œê³  ê³„ì…¨ë‚˜ìš”?

í•œë²ˆ ì½”ë“œë¡œ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```
import React, { useState } from 'react'

const Counter = () => {
  const [count, setCount] = useState(0)
  console.log(count)

  const increase = () => {
    setCount(count + 1)
  }

  return (
    <div>
      <button onClick={increase}>+</button>
      <p>{count}</p>
    </div>
  )
}

export default Counter
```

ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ìƒíƒœê°’ì´ 1 ì¦ê°€í•˜ê³  í˜„ì¬ ì¹´ìš´íŠ¸ ê°’ì„ ì½˜ì†”ì— ì¶œë ¥í•˜ëŠ” ê°„ë‹¨í•œ ì˜ˆì œì…ë‹ˆë‹¤.

![](https://drive.google.com/uc?export=view&id=1UQK29ktv73cD9hX-EQKxXjynjcjuqD93)

ì˜ˆìƒí–ˆë˜ ëŒ€ë¡œ ë²„íŠ¼ì„ í•œ ë²ˆ ëˆ„ë¥´ë©´ ìƒíƒœê°’ì´ í•œë²ˆ ë³€í™”í•˜ë©´ì„œ ì¬ë Œë”ë§ì´ ìˆ˜í–‰ë˜ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤.  
ì´ì œ ìœ„ì˜ ì½”ë“œë¥¼ ì¡°ê¸ˆ ìˆ˜ì •í•´ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ ìƒíƒœë¥¼ ì„¸ ë²ˆ ìˆ˜ì •í•˜ë„ë¡ í•´ë³´ê² ìŠµë‹ˆë‹¤.

```
import React, { useState } from 'react'

const Counter = () => {
  const [count, setCount] = useState(0)
  console.log(count)

  const increase = () => {
    setCount(count + 1)
    setCount(count + 2)
    setCount(count + 3)
  }

  return (
    <div>
      <button onClick={increase}>+</button>
      <p>{count}</p>
    </div>
  )
}

export default Counter
```

![](https://drive.google.com/uc?export=view&id=11UHcRxXE_AcFc2n6jRjwPFZMkRUMCWKv)

í•˜ì§€ë§Œ ì´ì „ê³¼ ë‹¬ë¦¬ ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ ì½˜ì†”ì—ëŠ” ìˆ«ìê°€ í•œë²ˆì”©ë§Œ ì¶œë ¥ë˜ëŠ”ë°ìš”, ì´ë ‡ê²Œ ìƒê°í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ğŸ§ ì—¥, ì›ë˜ ì˜ˆìƒëŒ€ë¡œë¼ë©´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë¥¼ 3ë²ˆ í˜¸ì¶œí•˜ë©´ ë Œë”ë§ì´ 3ë²ˆ ì¼ì–´ë‚˜ ì½˜ì†”ì—ë„ ìˆ«ìê°€ 3ë²ˆì”© ì¶œë ¥ë˜ì–´ì•¼ í•˜ì§€ ì•Šë‚˜ìš”?

í•˜ì§€ë§Œ ì´ëŠ” ë²„ê·¸ê°€ ì•„ë‹Œ ì˜ë„ëœ ì„±ì§ˆë¡œ, ë¶ˆí•„ìš”í•œ ë Œë”ë§ì„ ìµœì†Œí™”í•˜ê¸° ìœ„í•´ ì—…ë°ì´íŠ¸í•˜ëŠ” ìƒíƒœì™€ ìŠ¤ì½”í”„ê°€ ë™ì¼í•œ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ê°€ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œë˜ë©´ **ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤í–‰ëœ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë§Œì„ ë¦¬ì•¡íŠ¸ ë‚´ë¶€ì˜ ì—…ë°ì´íŠ¸ íì— ì‚½ì…í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.**

```
const increase = () => {
    // setCount(count + 1)
    // setCount(count + 2)
    // ë™ì¼í•œ ìŠ¤ì½”í”„ì—ì„œ ë™ì¼í•œ ìƒíƒœê°’ì„ ì—…ë°ì´íŠ¸í•˜ëŠ” ì—¬ëŸ¬ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ëŠ” ë§ˆì§€ë§‰ ë³€ê²½ì‚¬í•­ë§Œì´ ì—…ë°ì´íŠ¸ íì— ì‚½ì…ë©ë‹ˆë‹¤.
    setCount(count + 3)
  }
```

í•˜ì§€ë§Œ, ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ì—ì„œëŠ” ìƒíƒœì˜ ì—…ë°ì´íŠ¸ê°€ ì¡°ê¸ˆ ë‹¤ë¥´ê²Œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

```
const asyncIncrease = () => {
    setTimeout(() => {
      setCount(count + 1)
      setCount(count + 2)
      setCount(count + 3)
    }, 1000)
  }
```

![](https://drive.google.com/uc?export=view&id=11UHcRxXE_AcFc2n6jRjwPFZMkRUMCWKv)

ë²„íŠ¼ì„ í•œ ë²ˆ ëˆ„ë¥´ë©´ ì½˜ì†”ì´ í•œ ë²ˆ ì¶œë ¥ë˜ë˜ ì´ì „ê³¼ëŠ” ë‹¬ë¦¬, ì´ì œëŠ” ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œ ë§Œí¼ ë Œë”ë§ì„ ë‹¤ì‹œ ìˆ˜í–‰í•˜ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤!

#

ì´ëŠ” ë¦¬ì•¡íŠ¸ ë²„ì „ 17ê¹Œì§€ëŠ” í´ë¦­ ë“± ë¸Œë¼ìš°ì € ì´ë²¤íŠ¸ê°€ ë°œìƒí•  ë•Œë§Œ ë°°ì¹˜(Batch) ì—…ë°ì´íŠ¸ë¥¼ ì‹¤í–‰í•˜ê³ , `setTimeout` ì´ë‚˜ `fetch` ë“±ì˜ Web APIì— ëŒ€í•´ì„œëŠ” ì¬ë Œë”ë§ì„ ë°°ì¹˜ë¡œ ê´€ë¦¬í•˜ì§€ ì•Šì•˜ê¸° ë•Œë¬¸ì— ìƒê¸´ í˜„ìƒì¸ë°ìš”, ë¦¬ì•¡íŠ¸ 18ì—ì„œëŠ” ì´ì œ ì–´ë–¤ ì½”ë“œì—ì„œ ì—¬ëŸ¬ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ë¥¼ ì‹¤í–‰í•˜ë“  ì¬ë Œë”ë§ì„ ë°°ì¹˜ë¡œ ê´€ë¦¬í•˜ê²Œ ë©ë‹ˆë‹¤.

### **ë¦¬ì•¡íŠ¸ 18ì˜ automatic batching**

ì´ì œ ë¦¬ì•¡íŠ¸ 18ì—ì„œ ì¼ì–´ë‚˜ëŠ” ë™ì‘ì„ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.  
ë™ê¸° í”„ë¡œì„¸ìŠ¤ ë‚´ì—ì„œëŠ” ë³€í™”ê°€ ì—†ì§€ë§Œ ë¹„ë™ê¸° í”„ë¡œì„¸ìŠ¤ ì•ˆì—ì„œì˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ë°©ì‹ì´ ë³€í–ˆëŠ”ë°ìš”, í•œë²ˆ ì½”ë“œë¡œ í™•ì¸í•´ ë³´ê² ìŠµë‹ˆë‹¤.

```
import React, { useState } from 'react'

const Counter = () => {
  const [count, setCount] = useState(0)
  console.log(count)

  const asyncIncrease = () => {
    setTimeout(() => {
      setCount(count + 1)
      setCount(count + 2)
      setCount(count + 3)
    }, 1000)
  }

  return (
    <div>
      <button onClick={asyncIncrease}>+</button>
      <p>{count}</p>
    </div>
  )
}

export default Counter
```

ë¦¬ì•¡íŠ¸ ë²„ì „ 17ì—ì„œ í…ŒìŠ¤íŠ¸í–ˆì„ ë•ŒëŠ” ë²„íŠ¼ì„ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ ì„¸ ë²ˆì”© ì¬ë Œë”ë§ì´ ìˆ˜í–‰ë˜ì—ˆëŠ”ë°ìš”, ê³¼ì—° ì´ë²ˆì—ëŠ” ì–´ë–¨ê¹Œìš”?

![](https://drive.google.com/uc?export=view&id=1v4taOQizR7qupAa0_zRwllDXe2viGX3Q)

ì¬ë Œë”ë§ì´ ë‹¤ì‹œ í•œë²ˆì”©ë§Œ ìˆ˜í–‰ë˜ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤!

ì´ë ‡ê²Œ ë¦¬ì•¡íŠ¸ 18ë¶€í„°ëŠ” ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ë¶€ì—ì„œì˜ ë Œë”ë§ ì—­ì‹œ ë°°ì¹˜ë¡œ ì²˜ë¦¬ëœë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆëŠ”ë°ìš”, ë§Œì•½ ë¦¬ì•¡íŠ¸ 18ì—ì„œ ì´ì „ì²˜ëŸ¼ ë¹„ë™ê¸° ë°°ì¹˜ë¥¼ ì ìš©í•˜ì§€ ì•Šìœ¼ë ¤ë©´ ì–´ë–»ê²Œ í•´ì•¼ í• ê¹Œìš”?

### **ReactDOM.flushSync()**

ê¸°ì¡´ì²˜ëŸ¼ ë¹„ë™ê¸° ì‘ì—… ë‚´ì—ì„œ ë°°ì¹˜ ì—…ë°ì´íŠ¸ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë ¤ë©´ `ReactDOM.flushSync()`Â ë©”ì„œë“œë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í”í•œ ê²½ìš°ëŠ” ì•„ë‹ˆê² ì§€ë§Œ ë§Œì•½ ì´ì „ì²˜ëŸ¼ ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ì˜ ì¤‘ì²©ëœ ìƒíƒœ ì—…ë°ì´íŠ¸ì— ë°°ì¹˜ê°€ í•„ìš”í•˜ì§€ ì•Šì„ ì‹œ, `flushSync` í•¨ìˆ˜ë¥¼ í†µí•´ ì´ì „ ë²„ì „ì²˜ëŸ¼ ë™ì‘í•˜ë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```
import React, { useState } from 'react'
import { flushSync } from 'react-dom'

const Counter = () => {
  const [count, setCount] = useState(0)
  console.log(count)

  const asyncIncrease = () => {
    setTimeout(() => {
      flushSync(() => {
        setCount(count + 1)
      })
      flushSync(() => {
        setCount(count + 2)
      })
      flushSync(() => {
        setCount(count + 3)
      })
    }, 1000)
  }

  return (
    <div>
      <button onClick={asyncIncrease}>+</button>
      <p>{count}</p>
    </div>
  )
}

export default Counter
```

![ReactDOM.flushSync()ë¥¼ ì‚¬ìš©í•œ ê²°ê³¼, ë¦¬ì•¡íŠ¸ ~17 ì²˜ëŸ¼ ì¬ë Œë”ë§ì´ ì—¬ëŸ¬ë²ˆ ìˆ˜í–‰ë˜ëŠ” ëª¨ìŠµì…ë‹ˆë‹¤.
](https://drive.google.com/uc?export=view&id=1yHbjbrWKmBv2yivtLNHvGK7PbhhABrrw)

ì§€ê¸ˆê¹Œì§€ ë¦¬ì•¡íŠ¸ì˜ ë°°ì¹­ ì—…ë°ì´íŠ¸ í˜¹ì‹œ ë¦¬ì•¡íŠ¸ 18ì—ì„œ ë‹¬ë¼ì§„ ë°°ì¹­ ê¸°ë²•ì´ ë” ê¶ê¸ˆí•˜ì‹œë‹¤ë©´, [ì´ ê¹ƒí—ˆë¸Œ ì´ìŠˆ](https://github.com/reactwg/react-18/discussions/21)ì—ì„œ ìì„¸íˆ í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆì„ ê±°ì—ìš”! ğŸ˜†
